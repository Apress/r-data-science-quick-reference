## ------------------------------------------------------------------------
write_csv(
    tribble(
        ~country,  ~`2002`, ~`2003`, ~`2004`, ~`2005`,
        "Numenor",  123456,  132654,      NA,  324156,
        "Westeros", 314256,  NA,          NA,  465321,
        "Narnia",   432156,  NA,          NA,      NA,
        "Gondor",   531426,  321465,  235461,  463521,
        "Laputa",    14235,   34125,   45123,   51234,
    ),
    "data/income.csv"
)


## ------------------------------------------------------------------------
mydata <- read_csv("data/income.csv",
                   col_types = "cdddd")
mydata <- gather(
    data = mydata,
    key = "year",
    value = "mean_income",
    -country
)
mydata <- drop_na(mydata)


## ------------------------------------------------------------------------
mydata <- drop_na(
    gather(
        data = read_csv("data/income.csv",
                        col_types = "cdddd"),
        key = "year",
        value = "mean_income",
        -country
    )   
)


## ---- echo = FALSE-------------------------------------------------------
f <- invisible
x <- 5


## ------------------------------------------------------------------------
x %>% f()


## ------------------------------------------------------------------------
f(x)


## ---- echo = FALSE-------------------------------------------------------
f <- g <- identity
h <- invisible


## ------------------------------------------------------------------------
x %>% f() %>% g() %>% h()


## ------------------------------------------------------------------------
h(g(f(x)))


## ------------------------------------------------------------------------
x %>% f %>% g %>% h


## ------------------------------------------------------------------------
mydata <- read_csv("data/income.csv",
                   col_types = "cdddd") %>%
    gather(key = "year", value = "mean_income", -country) %>%
    drop_na()


## ------------------------------------------------------------------------
mydata <- read_csv("data/income.csv",
                   col_types = "cdddd") %>%
    gather(key = "year", value = "mean_income", -country) %>%
    drop_na()

mydata <- read_csv("data/income.csv", 
                   col_types = "cdddd") %>%
    gather(data = ., key = "year", value = "mean_income", -country) %>%
    drop_na()

mydata <- read_csv("data/income.csv", 
                   col_types = "cdddd") %>%
    gather(key = "year", value = "mean_income", -country, data = .) %>%
    drop_na()


## ------------------------------------------------------------------------
rnorm(5) %>% tibble(x = ., y = .)


## ------------------------------------------------------------------------
rnorm(5) %>% tibble(x = ., y = abs(.))


## ------------------------------------------------------------------------
rnorm(5) %>% tibble(x = sin(.), y = abs(.))


## ------------------------------------------------------------------------
rnorm(5) %>% { tibble(x = sin(.), y = abs(.)) }


## ------------------------------------------------------------------------
h <- . %>% f() %>% g()


## ------------------------------------------------------------------------
pipeline <- . %>% 
    gather(key = "year", value = "mean_income", -country) %>%
    drop_na()


## ------------------------------------------------------------------------
library(magrittr)


## ------------------------------------------------------------------------
mydata <- read_csv("data/income.csv",
                   col_types = "cdddd")
mydata %<>% pipeline()


## ------------------------------------------------------------------------
mydata <- read_csv("data/income.csv",
                   col_types = "cdddd")
mydata <- mydata %>% pipeline()


## ------------------------------------------------------------------------
mydata <- tibble(x = rnorm(5), y = rnorm(5))
mydata %>% { .$x - .$y }


## ------------------------------------------------------------------------
mydata %$% { x - y }

