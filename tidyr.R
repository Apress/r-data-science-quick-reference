## ------------------------------------------------------------------------
mean_income <- tribble(
    ~country,  ~`2001`, ~`2002`, ~`2003`, ~`2004`, ~`2005`,
    "Numenor",  123456,  132654,  321646,  324156,  325416,
    "Westeros", 314256,  432165,  546123,  465321,  561423,
    "Narnia",   432156,  342165,  564123,  543216,  465321,
    "Gondor",   531426,  321465,  235461,  463521,  561423,
    "Laputa",    14235,   34125,   45123,   51234,   54321
)


## ------------------------------------------------------------------------
gather(
    data = mean_income,
    key = "year",
    value = "income",
    `2001`, `2001`, `2002`,
    `2003`, `2004`, `2005`
)


## ------------------------------------------------------------------------
gather(
    data = mean_income,
    key = "year",
    value = "income",
    -country,
    convert = TRUE
)


## ------------------------------------------------------------------------
tidy_income <- gather(
    data = mean_income,
    key = "year",
    value = "income",
    -country,
    convert = TRUE
)
spread(
    data = tidy_income,
    key = "year",
    value = "income"
)


## ------------------------------------------------------------------------
tbl <- tribble(
    ~date,
    "11/5",
    "4/7",
    "21/12"
)
separate(tbl, date, into = c("day", "month"))


## ------------------------------------------------------------------------
separate(tbl, date, into = c("day", "month"), remove = FALSE)


## ------------------------------------------------------------------------
separate(tbl, date, into = c("day", "month"), convert = TRUE)


## ------------------------------------------------------------------------
tbl <- tribble(
    ~date,
    "11th of month 5",
    "4th of month 7",
    "21st of month 12"
)
separate(tbl, date, into = c("day", "month"), 
         sep = "([:alpha:]|[:space:])+")


## ------------------------------------------------------------------------
tbl <- tribble(
    ~date,
    "11th of May",
    "4th of July",
    "21st of December"
)


## ---- echo=FALSE---------------------------------------------------------
tidyr::extract(
    tbl, date,
    into = c("day", "month"),
    regex = "([:digit:]+)(?:[:alpha:]|[:space:])+[:space:]([:alpha:]+)"
)


## ------------------------------------------------------------------------
tbl <- tribble(
    ~date,
    "11/5",
    "4/7",
    "21/12"
)
tbl2 <- separate(tbl, date, into = c("day", "month"))


## ------------------------------------------------------------------------
unite(tbl2, col = "date", day, month)


## ------------------------------------------------------------------------
unite(tbl2, col = "date", day, month, sep = "/")


## ------------------------------------------------------------------------
unite(
   tbl2,
   col = "date", day, month, 
   sep = "/", remove = FALSE
)


## ------------------------------------------------------------------------
military_casualties <- tribble(
    ~war, ~groups, ~deaths,
    
    'WW1',
    "Allied Powers/Central Powers",
    "5.7,4.0",
    
    'WW2', 
    "Germany/Japan/USSR/British Empire/USA", 
    "5.3,2.1,10.7,0.6,0.4"
)


## ------------------------------------------------------------------------
separate_rows(
    military_casualties,
    groups, deaths,
    sep = "/|,"
)


## ------------------------------------------------------------------------
tbl <- tribble(
    ~A, ~B, ~C,
     1, 11, 21,
     2, 11, 22,
     4, 13, 32
)
expand(tbl, A, B)


## ------------------------------------------------------------------------
expand(tbl, A = 1:4, B)


## ------------------------------------------------------------------------
crossing(A = 1:3, B = 11:13)


## ------------------------------------------------------------------------
tbl <- tribble(
    ~A, ~B, ~C,
    1, 11, 21,
    2, 11, 22,
    2, 11, 12,
    4, 13, 42,
    4, 13, 32
)
expand(tbl, nesting(A, B))


## ------------------------------------------------------------------------
complete(tbl, A = 1:4)
complete(tbl, B = 11:13)
complete(tbl, A = 1:4, B = 11:13)


## ------------------------------------------------------------------------
mean_income <- tribble(
    ~country,  ~`2002`, ~`2003`, ~`2004`, ~`2005`,
    "Numenor",  123456,  132654,      NA,  324156,
    "Westeros", 314256,  NA,          NA,  465321,
    "Narnia",   432156,  NA,          NA,      NA,
    "Gondor",   531426,  321465,  235461,  463521,
    "Laputa",    14235,   34125,   45123,   51234,
)
drop_na(mean_income)


## ------------------------------------------------------------------------
tidy_mean_income <- gather(
    data = mean_income,
    key = "year",
    value = "mean_income",
    -country
)
drop_na(tidy_mean_income)


## ------------------------------------------------------------------------
replace_na(mean_income, list(
    `2003` = mean(mean_income$`2003`, na.rm = TRUE)
))

replace_na(mean_income, list(
    `2003` = mean(mean_income$`2003`, na.rm = TRUE),
    `2004` = mean(mean_income$`2004`, na.rm = TRUE),
    `2005` = mean(mean_income$`2005`, na.rm = TRUE)
))


## ------------------------------------------------------------------------
tbl <- read_csv(
    "year, quarter, income
    2011, Q1, 13
    , Q2, 12
    , Q3, 14
    , Q4, 11
    2012, Q1, 12
    , Q2, 14
    , Q3, 15
    , Q4, 17"
)


## ------------------------------------------------------------------------
fill(tbl, year)


## ------------------------------------------------------------------------
tbl <- tribble(
    ~A, ~B, ~C,
    1, 11, 21,
    1, 11, 12,
    2, 42, 22,
    2, 15, 22,
    2, 15, 32,
    4, 13, 32
)


## ------------------------------------------------------------------------
nested_tbl <- nest(tbl, B, C)
nested_tbl
nested_tbl[[1,2]]


## ------------------------------------------------------------------------
nested_tbl <- nest(tbl, B, C, .key = "BC")
nested_tbl
nested_tbl$BC


## ------------------------------------------------------------------------
nest(tbl, B)
nest(tbl)


## ------------------------------------------------------------------------
nested_tbl
unnest(nested_tbl)

